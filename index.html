<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EduSimplify ‚Äì CEFR-Aware French Text Simplifier</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-main: #f5f5fb;
      --bg-card: #ffffff;
      --bg-original: #fdf7f1;
      --bg-simplified: #f3f9ff;
      --accent: #4b6fff;
      --accent-soft: #e0e7ff;
      --border-soft: #e0e0eb;
      --text-main: #222222;
      --text-soft: #555555;
      --danger: #e54b4b;
      --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-sans);
      background: radial-gradient(circle at top left, #f6f0ff 0, #f5f5fb 40%, #f0f4ff 100%);
      color: var(--text-main);
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      gap: 12px;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-area img {
      width: 56px;
      height: 56px;
      object-fit: contain;
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.8rem;
      letter-spacing: 0.03em;
    }

    .title-block p {
      margin: 2px 0 0;
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .tagline {
      font-size: 0.85rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(75, 111, 255, 0.08);
      color: #2f3f8f;
      border: 1px solid rgba(75, 111, 255, 0.17);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tagline span {
      font-size: 1rem;
    }

    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 18px 18px 20px;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.04),
        0 1px 0 rgba(15, 23, 42, 0.04);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .card + .card {
      margin-top: 16px;
    }

    h2 {
      font-size: 1.1rem;
      margin-top: 0;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    h2 span.icon {
      font-size: 1.2rem;
    }

    h3 {
      font-size: 0.95rem;
      margin: 12px 0 8px;
    }

    p {
      margin: 6px 0;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .small {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    textarea {
      width: 100%;
      min-height: 130px;
      resize: vertical;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      font-family: inherit;
      font-size: 0.95rem;
      line-height: 1.6;
      background: #fff;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(75, 111, 255, 0.3);
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 10px;
      align-items: center;
    }

    .controls-row > div {
      background: #f8f9ff;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
    }

    .controls-row label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .controls-row input[type="radio"] {
      margin-right: 4px;
    }

    .controls-row select {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 4px 6px;
      font-size: 0.8rem;
      background: #ffffff;
      min-width: 80px;
    }

    .primary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
      justify-content: space-between;
      align-items: center;
    }

    .primary-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
    }

    #simplify-btn {
      background: linear-gradient(135deg, #4b6fff, #7b5cff);
      color: #fff;
      box-shadow: 0 10px 22px rgba(75, 111, 255, 0.35);
    }

    #simplify-btn:disabled {
      opacity: 0.7;
      cursor: wait;
      box-shadow: none;
    }

    .secondary-btn {
      background: #f2f4ff;
      color: #24308f;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .danger-btn {
      background: #fff2f2;
      color: #b91c1c;
      border: 1px solid rgba(239, 68, 68, 0.5);
    }

    .layout-two {
      margin-top: 18px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 14px;
    }

    .panel {
      border-radius: 14px;
      padding: 12px 12px 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: var(--bg-card);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .panel.original {
      background: var(--bg-original);
    }

    .panel.simplified {
      background: var(--bg-simplified);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .panel-header h3 {
      margin: 0;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.04);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: #4b5563;
    }
    
    .badge-blue {
      background: #dbeafe;
      color: #1e40af;
      border-color: #93c5fd;
    }

    .meta-line {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .meta-line strong {
      font-weight: 600;
    }

    .text-box {
      margin-top: 6px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.75);
      min-height: 80px;
      font-size: 0.9rem;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .diagnostic {
      margin-top: 4px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .diagnostic-list {
      padding-left: 18px;
      margin: 4px 0 0;
    }

    .diagnostic-list li {
      margin: 2px 0;
    }

    .word-hard {
      background: rgba(248, 113, 113, 0.15);
      border-bottom: 1px dotted rgba(220, 38, 38, 0.8);
      padding: 1px 0;
    }

    .word-medium {
      background: rgba(251, 191, 36, 0.15);
      border-bottom: 1px dotted rgba(202, 138, 4, 0.9);
      padding: 1px 0;
    }

    .word-easy {
      background: rgba(34, 197, 94, 0.08);
      border-bottom: 1px dotted rgba(22, 163, 74, 0.7);
      padding: 1px 0;
    }

    .cefr-row {
      margin-top: 14px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 12px;
      align-items: stretch;
    }

    .cefr-card {
      border-radius: 14px;
      padding: 10px 12px 12px;
      background: #eef2ff;
      color: #111827;
      box-shadow:
        0 6px 16px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(129, 140, 248, 0.7);
    }

    .cefr-card h3 {
      margin: 0 0 4px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cefr-card p {
      margin: 4px 0;
      font-size: 0.8rem;
      color: #1f2933;
    }

    .cefr-card p strong {
      color: #111827;
    }

    .strategy-card {
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.02);
      font-size: 0.8rem;
    }

    .tts-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 0.8rem;
    }

    .tts-row select {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 3px 7px;
      font-size: 0.8rem;
      background: #ffffff;
    }

    #tts-play-btn {
      padding: 6px 10px;
      font-size: 0.8rem;
    }

    /* üîµ Floating avatar (new) */
    .avatar-floating {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 72px;
      height: 72px;
      border-radius: 999px;
      background: #ffffff;
      box-shadow:
        0 12px 30px rgba(15, 23, 42, 0.25),
        0 0 0 2px rgba(79, 70, 229, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      z-index: 999;
      animation: avatar-bounce 2.8s ease-in-out infinite;
      cursor: pointer;
    }

    .avatar-floating img {
      width: 100%;
      height: 100%;
      border-radius: 999px;
      object-fit: cover;
    }

    .avatar-floating:hover {
      animation-duration: 1.5s;
      transform: translateY(-2px) scale(1.03);
      box-shadow:
        0 16px 40px rgba(15, 23, 42, 0.35),
        0 0 0 2px rgba(79, 70, 229, 0.28);
    }

    @keyframes avatar-bounce {
      0%, 100% {
        transform: translateY(0) scale(1);
      }
      25% {
        transform: translateY(-4px) scale(1.02);
      }
      50% {
        transform: translateY(0) scale(1.01);
      }
      75% {
        transform: translateY(3px) scale(0.99);
      }
    }

    @media (max-width: 860px) {
      .layout-two {
        grid-template-columns: minmax(0, 1fr);
      }
      .cefr-row {
        grid-template-columns: minmax(0, 1fr);
      }
      header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    @media (max-width: 600px) {
      .card {
        padding: 14px;
      }
      .panel {
        padding: 10px;
      }
      .page {
        padding-inline: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo-area">
        <img src="/static/logo.png" alt="EduSimplify logo" />
        <div class="title-block">
          <h1>EduSimplify</h1>
          <p>CEFR-aware French text simplification for learners and teachers.</p>
        </div>
      </div>
      <div class="tagline">
        <span>üìö</span>
        <span>CEFR - A1 to C1</span>
      </div>
    </header>

    <section class="card">
      <h2>
        <span class="icon">‚úèÔ∏è</span>
        Paste a French text to simplify
      </h2>
      <p class="small">
        Paste any French sentence or paragraph (classical or modern). EduSimplify analyses difficulty,
        estimates a CEFR level, and generates a simplified version based on your settings.
      </p>

      <textarea id="input-text" placeholder="TEXT"></textarea>

      <div class="controls-row">
        <div>
          <strong>Mode:</strong>
          <label><input type="radio" name="mode" value="light"> Light</label>
          <label><input type="radio" name="mode" value="standard" checked> Standard</label>
          <label><input type="radio" name="mode" value="strong"> Strong</label>
        </div>

        <div>
          <strong>Strategy:</strong>
          <label><input type="radio" name="strategy" value="auto" checked> Auto</label>
          <label><input type="radio" name="strategy" value="target"> Target level</label>
          <select id="target-level" disabled>
            <option value="">CEFR level‚Ä¶</option>
            <option value="A1">A1</option>
            <option value="A2">A2</option>
            <option value="B1">B1</option>
            <option value="B2">B2</option>
            <option value="C1">C1</option>
          </select>
        </div>
      </div>

      <div class="primary-row">
        <div class="primary-actions">
          <button id="simplify-btn">‚öôÔ∏è Simplify and analyse</button>
          <button id="copy-original-btn" class="secondary-btn">üìã Copy original</button>
          <button id="copy-simplified-btn" class="secondary-btn">üìã Copy simplified</button>
        </div>
        <div class="primary-actions">
          <button id="export-txt-btn" class="secondary-btn">üìù Export .txt</button>
          <button id="export-report-btn" class="secondary-btn">üìÑ Export report (.txt)</button>
          <button id="export-pdf-btn" class="secondary-btn">üñ®Ô∏è PDF preview</button>
        </div>
      </div>

      <div class="tts-row">
        <span>üîä Read aloud:</span>
        <label for="tts-target">Text</label>
        <select id="tts-target">
          <option value="original">Original</option>
          <option value="simplified">Simplified</option>
        </select>

        <label for="tts-voice">Voice</label>
        <select id="tts-voice">
          <option value="female">Female</option>
          <option value="male">Male</option>
        </select>

        <label for="tts-speed">Speed</label>
        <select id="tts-speed">
          <option value="slow">Slow</option>
          <option value="normal" selected>Normal</option>
          <option value="fast">Fast</option>
        </select>

        <button id="tts-play-btn" class="secondary-btn">üîà Play</button>
      </div>
    </section>

    <section class="layout-two">
      <div class="panel original">
        <div class="panel-header">
          <h3>Original text</h3>
          <span id="original-meta" class="meta-line">Level: ‚Äî ¬∑ Words: ‚Äî</span>
        </div>
        <p id="original-band" class="small"></p>
        <p id="original-explanation" class="small"></p>
        <div id="original-text-box" class="text-box">
          The original text will appear here.
        </div>
        <div id="original-diagnostic" class="diagnostic"></div>
      </div>

      <div class="panel simplified">
        <div class="panel-header">
          <h3>Simplified text</h3>
          <span id="simplified-meta" class="meta-line">Level: ‚Äî ¬∑ Words: ‚Äî</span>
        </div>
        <p id="simplified-band" class="small"></p>
        <p id="simplified-explanation" class="small"></p>
        <div id="simplified-text-box" class="text-box">
          The simplified version will appear here.
        </div>
      </div>
    </section>

    <section class="cefr-row">
      <div class="cefr-card">
        <h3>üéì CEFR ‚Äì Result</h3>
        <p id="cefr-level-line"><strong>Transformation:</strong> En attente d'analyse‚Ä¶</p>
        <p id="cefr-description">
          Le texte est au niveau ‚Ä¶ Une explication d√©taill√©e appara√Ætra ici apr√®s l'analyse.
        </p>
        <p id="cefr-strategy" class="small"></p>
      </div>

      <div class="strategy-card">
        <strong>‚öôÔ∏è Simplification strategy</strong>
        <p id="strategy-explanation" class="small" style="margin-top: 4px;">
          La strat√©gie pr√©cise de simplification (d√©coupage des phrases, choix du lexique, etc.) sera affich√©e ici.
        </p>
        <p class="small">
          No text is stored. Everything is processed locally via the FastAPI backend.
        </p>
      </div>
    </section>
  </div>

  <!-- üîµ Floating avatar using /static/avatar1.png -->
  <div class="avatar-floating" title="Need help understanding the level?">
    <img src="/static/avatar1.png" alt="EduSimplify assistant avatar" />
  </div>

  <script>
    const simplifyBtn = document.getElementById("simplify-btn");
    const inputText = document.getElementById("input-text");
    const targetLevelSelect = document.getElementById("target-level");

    const originalBox = document.getElementById("original-text-box");
    const simplifiedBox = document.getElementById("simplified-text-box");
    const originalMeta = document.getElementById("original-meta");
    const simplifiedMeta = document.getElementById("simplified-meta");

    const cefrLevelLine = document.getElementById("cefr-level-line");
    const cefrDescription = document.getElementById("cefr-description");
    const cefrStrategy = document.getElementById("cefr-strategy");
    const strategyExplanationEl = document.getElementById("strategy-explanation");

    const ttsPlayBtn = document.getElementById("tts-play-btn");
    const ttsTargetSelect = document.getElementById("tts-target");
    const ttsVoiceSelect = document.getElementById("tts-voice");
    const ttsSpeedSelect = document.getElementById("tts-speed");

    document
      .querySelectorAll('input[name="strategy"]')
      .forEach((radio) => {
        radio.addEventListener("change", () => {
          if (radio.value === "target" && radio.checked) {
            targetLevelSelect.disabled = false;
          } else if (radio.value === "auto" && radio.checked) {
            targetLevelSelect.disabled = true;
            targetLevelSelect.value = "";
          }
        });
      });

    function getSelectedStrategy() {
      const checked = document.querySelector('input[name="strategy"]:checked');
      return checked ? checked.value : "auto";
    }

    let ttsVoices = [];

    function loadVoices() {
      ttsVoices = window.speechSynthesis.getVoices();
    }

    if ("speechSynthesis" in window) {
      loadVoices();
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }

    function pickVoice(gender) {
      if (!ttsVoices || ttsVoices.length === 0) return null;
      const frVoices = ttsVoices.filter(
        (v) => v.lang && v.lang.toLowerCase().startsWith("fr")
      );
      if (frVoices.length === 0) return ttsVoices[0];

      const pattern =
        gender === "female"
          ? /female|femme|woman|frau|madame/i
          : /male|homme|man|herr|monsieur/i;

      const match = frVoices.find((v) => pattern.test(v.name));
      return match || frVoices[0];
    }

    ttsPlayBtn.addEventListener("click", () => {
      if (!("speechSynthesis" in window)) {
        alert("Text-to-speech is not available in this browser.");
        return;
      }

      const target = ttsTargetSelect.value || "original";
      const voicePref = ttsVoiceSelect.value || "female";
      const speed = ttsSpeedSelect.value || "normal";

      const originalText =
        document.getElementById("original-text-box").innerText || "";
      const simplifiedText =
        document.getElementById("simplified-text-box").innerText || "";

      const text = target === "simplified" ? simplifiedText : originalText;

      if (!text.trim()) {
        alert("There is no text to read in the selected area.");
        return;
      }

      window.speechSynthesis.cancel();

      const utter = new SpeechSynthesisUtterance(text);
      const voice = pickVoice(voicePref);
      if (voice) utter.voice = voice;

      if (speed === "slow") utter.rate = 0.8;
      else if (speed === "fast") utter.rate = 1.25;
      else utter.rate = 1.0;

      utter.lang = (voice && voice.lang) || "fr-FR";
      window.speechSynthesis.speak(utter);
    });

    simplifyBtn.addEventListener("click", async () => {
      const text = inputText.value.trim();
      if (!text) {
        alert("Please enter a French text to simplify.");
        return;
      }

      const strategy = getSelectedStrategy();
      const targetLevelInput =
        strategy === "target" && !targetLevelSelect.disabled
          ? targetLevelSelect.value || null
          : null;

      const payload = {
        text: text,
        target_level: targetLevelInput,
      };

      simplifyBtn.disabled = true;
      simplifyBtn.textContent = "‚è≥ Processing‚Ä¶";

      try {
        const response = await fetch("/simplify", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!response.ok) {
          throw new Error("Network or server error: " + response.status);
        }

        const data = await response.json();

        const simplified =
          data.simplified_text || "No simplified text returned.";
        const levelExplanation =
          data.level_explanation ||
          "Le niveau CECRL du texte n'a pas pu √™tre d√©termin√©.";
        const strategyText =
          data.simplification_strategy ||
          "La strat√©gie de simplification n'a pas √©t√© d√©crite par le mod√®le.";

        const detectedLevel = data.detected_level || "?";
        const finalLevel =
          data.target_level ||
          targetLevelInput ||
          "?";

        originalBox.textContent = text;
        simplifiedBox.textContent = simplified;

        const originalWords = text.split(/\s+/).filter(Boolean).length;
        const simplifiedWords = simplified
          .split(/\s+/)
          .filter(Boolean).length;

        originalMeta.innerHTML =
          `Niveau du texte original : ` +
          `<span class="badge">${detectedLevel}</span> ¬∑ Mots : ${originalWords}`;

        simplifiedMeta.innerHTML =
          `Niveau du texte simplifi√© : ` +
          `<span class="badge badge-blue">${finalLevel}</span> ¬∑ Mots : ${simplifiedWords}`;

        cefrLevelLine.innerHTML =
          `<strong>Transformation :</strong> du niveau ` +
          `<span class="badge">${detectedLevel}</span> ` +
          `vers le niveau <span class="badge badge-blue">${finalLevel}</span>`;

        cefrDescription.textContent = levelExplanation;

        if (strategy === "target") {
          cefrStrategy.textContent =
            `Niveau cible choisi : ${targetLevelInput || finalLevel}.`;
        } else {
          cefrStrategy.textContent =
            `Simplification automatique vers le niveau : ${finalLevel}.`;
        }

        strategyExplanationEl.textContent = strategyText;

      } catch (err) {
        console.error("Error during simplification:", err);
        alert("An error occurred during simplification. See console for details.");
      } finally {
        simplifyBtn.disabled = false;
        simplifyBtn.textContent = "‚öôÔ∏è Simplify and analyse";
      }
    });
  </script>  
</body>
</html>

<footer style="margin-top: 24px; font-size: 0.75rem; color: #6b7280; text-align: center;">
  ¬© 2025 CUO | EduSimplify ‚Äì NLP ¬∑ EdTech. All rights reserved.
</footer>
